# Network Flow ç½‘ç»œæµé—®é¢˜
+ Consider a network with capacity constraints on edges, given a source and a sink(target) t, what is the maximum flow from s to t?
+ A **flow network** is a directed graph $G=(V, E)$ where each edge has a *capacity* $c(u, v)\geq 0$
+ A **flow** in G is a function $f:V\times V\rightarrow R$ satisfying
  + **ã€Capacity constraintã€‘ï¼šFor every $(u, v)\in E$, $0\leq f(u, v)\leq c(u, v)$**
  + **ã€Flow conservationã€‘ï¼šFor every $u\in V-\{s, t\}$:$\sum_{v\in V}f(v, u)=\sum_{v\in V}f(u, v)$**
+ The **value** of flow ğ‘“ is $|f|=\sum_{v\in V}f(s, v)=\sum_{v\in V}f(v, t)$
+ æœ€å¤§æµé—®é¢˜çš„ç›®æ ‡å³ä¸ºå¯»æ‰¾æœ€å¤§çš„ç½‘ç»œæµ $f$.

## ç®—æ³•æ€æƒ³
+ ä»ä¸€ä¸ªå¯è¡Œè§£å¼€å§‹ï¼Œé€æ­¥å¢å¼ºåˆ°æœ€ä¼˜è§£
### Simple Algorithm
+ ä»så¼€å§‹ï¼Œæ‰¾åˆ°ä¸€æ¡åˆ° t çš„è·¯å¾„ï¼Œæ‰¾åˆ°è¿™æ¡è·¯å¾„ä¸Šçš„æµé‡é™åˆ¶ï¼Œç”Ÿæˆä¸€ä¸ªsåˆ°tçš„æµf
+ åœ¨åŸå›¾ä¸Šå‡å»fï¼ˆè·¯å¾„å„è¾¹å‡å»ä½¿ç”¨çš„æµé‡ï¼‰
+ å†æ‰¾åˆ°ä¸€æ¡såˆ°tçš„è·¯å¾„ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ç›´åˆ°æ‰¾ä¸åˆ°è¿™æ ·çš„è·¯å¾„  
  ![](img/2019-12-16-02-08-10.png)
+ ç„¶è€ŒSimple Algorithmåªèƒ½å¾—åˆ°å¯è¡Œè§£ï¼Œè€Œæ— æ³•å¾—åˆ°æœ€ä¼˜è§£

### Residual Network
+ ç»™å®šä¸€ä¸ªflow network $G=(V, E)$ å’Œæµ $f$, æ®‹ä½™ç½‘ç»œè¢«å®šä¹‰ä¸º$G_f = (V, E_f)$ï¼Œå…¶ä¸­$E_f = V\times V$ï¼Œå¹¶ä¸”è¾¹çš„constraintæ»¡è¶³:  
  ![](img/2019-12-16-02-10-58.png)
+ ç›´è§‚ä¸Šï¼Œæ¯æ¡æ®‹ç•™ç½‘ç»œä¸­çš„è¾¹è¡¨ç¤º
  + è¿™æ¡è¾¹è¿˜èƒ½æ‰¿è½½çš„æµçš„å¤§å°ï¼Œæˆ–
  + å·²æ¨é€çš„æµä¸­ï¼Œåœ¨è¿™æ¡è¾¹ä¸Šèƒ½è¢«å–æ¶ˆçš„æµçš„å¤§å°ã€‚
+ åœ¨æ®‹ç•™ç½‘ç»œ$G_f$æ‰¾åˆ°ä»$s$åˆ°$t$çš„æµ$f'$ï¼Œæµ$f'$å¯ç”¨äºå¢å¼ºåŸç½‘ç»œä¸­çš„æµ$f$  
  ![](img/2019-12-16-02-13-02.png)
### â€œå¢å¼ºâ€è¯æ˜
+ ä»¤$G$ä¸ºæµç½‘ç»œï¼Œ$G_f$ä¸ºæ®‹ç•™ç½‘ç»œï¼Œ$f'$ä¸º$G_f$ä¸­çš„æµ
+ å®šä¹‰$f$é€šè¿‡$f'$çš„å¢å¼ºä¸º  
  ![](img/2019-12-16-09-03-31.png)
+ **ã€Lemmaã€‘ï¼š$(f\uparrow f')$ is a flow in G, and $|f\uparrow f'|=|f|+|f'|$**  
  ![](img/2019-12-16-08-59-48.png)
+ **ã€Lemmaã€‘ï¼šif ğ‘“ is a flow in ğº, ğ‘“_ğ‘ is a flow in ğº_ğ‘“, then (ğ‘“â†‘ğ‘“_ğ‘ ) is a flow in ğº.Moreover, |ğ‘“â†‘ğ‘“_ğ‘ |=|ğ‘“|+|ğ‘“_ğ‘ |.**
+ å› æ­¤ï¼ŒåŸç½‘ç»œä¸­çš„æµå¯è¢«æ®‹ç•™ç½‘ç»œä¸­çš„æµå¢å¼º

### Ford-Fulkerson Algorithm
+ ä¸æ–­è®¡ç®—å½“å‰æµçš„æ®‹ç•™ç½‘ç»œå¢å¼ºç°æœ‰æµï¼Œç›´åˆ°æ®‹ç•™ç½‘ç»œä¸­ä¸å†å­˜åœ¨å¢å¼ºæµ
```python
FordFulkersonMaxFlow(G, s, t):
Initialize flow f to value 0
while there is an augmenting path p in Gf
    Augment flow f along path p
    Update Gf
return f
```
![](img/2019-12-16-18-17-08.png)

### Ford-Fulkersonç®—æ³•å¤æ‚åº¦åˆ†æ
+ ä»¤$G$ä¸ºè¿é€šå›¾ï¼Œå› æ­¤$|E|=m>n=|V|$
+ åˆå§‹åŒ–æ­¥éª¤ï¼ˆå¯»æ‰¾ä¸€æ¡é€šè·¯ï¼‰éœ€è¦$O(m)$æ—¶é—´
+ æ¯ä¸€è½®åªéœ€è¦éå†ä¸€æ¬¡å›¾å³å¯ç»´æŠ¤æ®‹ç•™ç½‘ç»œï¼Œå› æ­¤æ¯æ¬¡è¿­ä»£çš„ä»£ä»·ä¸º$O(m)$
+ ä¸‹é¢è®¨è®ºè¿­ä»£æ¬¡æ•°
  + è‹¥capacityå‡ä¸º**æ­£æ•´æ•°**
    + ç”±äºæ¯æ¬¡è¿­ä»£æœ€å¤§æµ$f$å‡è‡³å°‘å¢åŠ 1ï¼Œå› æ­¤è‡³å¤šæœ‰$O(f_{OPT})$æ¬¡è¿­ä»£
    + æ•…æ—¶é—´å¤æ‚åº¦ä¸º$O(m\cdot f_{OPT})$
    + æç«¯æƒ…å†µä¸‹ï¼ˆæ¯æ¬¡å¢åŠ ä¸€ï¼‰çš„ä¸€ä¸ªä¾‹å­å¦‚å›¾
    + ![](img/2019-12-16-18-42-43.png)
  + è‹¥capacityä¸º**æœ‰ç†æ•°**
    + ç±»ä¼¼å‰ä¸€ç§æƒ…å†µï¼Œå¯ä»¥å°†æœ‰ç†æ•°æ•´æ•°åŒ–
    + è¿è¡Œæ—¶é—´ä»ä¸º$O(m\cdot f_{OPT})$
  + è‹¥capacityä¸º**æ­£å®æ•°**
    + Ford-Fulkersonç®—æ³•å¯èƒ½æ— æ³•ç»ˆæ­¢ï¼ˆä¸æ–­æ‰¾åˆ°å¢å¼ºæµï¼‰ï¼Œç”šè‡³æ— æ³•æ”¶æ•›åˆ°æœ€å¤§æµ
    + ä¾‹å¦‚ä¸‹å›¾
      ![](img/2019-12-16-18-43-47.png)



---
## æœ€å¤§æµæœ€å°å‰²å®šç†
+ å®šä¹‰ **Cut**: A cut of flow network G=(V, E) is a bipartition (S, T) of V such that $x\in S$ and $t\in T$, $S\cup T=V$ and $ST=\emptyset$
+ å®šä¹‰ **Capacity** of cut $(S, T)$ï¼š$c(S, T)=\sum_{u\in S}\sum_{v\in T}c(u, v)$
+ å®šä¹‰ Given flow $f$, **net flow** across the cut $(S, T)$ï¼š$f(S, T)=\sum_{u\in S}\sum_{v\in T}f(u, v)-\sum_{u\in S}\sum_{v\in T}f(v, u)$
+ å®šä¹‰ **Min-Cut**ï¼ša cut of minimum capacity among all cuts  
  ![](img/2019-12-16-09-10-33.png)
+ **ã€Lemmaã€‘ï¼šGiven a flow f in a flow network G, let $(S, T)$ be any cut of G, then $|f|=f(S, T)$**  
  ![](img/2019-12-16-09-22-39.png)
+ **ã€Corollaryã€‘:For any flow $f$ and any cut $(S, T)$, value of flow is *at most* the capacity of the cut. That is $|f|\leq c(S, T)$.** (ä»»æ„æµå°äºç­‰äºä»»æ„å‰²)
+ äº‹å®ä¸Šï¼Œä¸Šè¿°å®šç†å¯ä»¥è¢«å¢å¼ºåˆ°ï¼ˆ**æœ€å¤§æµç­‰äºæœ€å°å‰²**ï¼‰
+ **ã€Theorem æœ€å¤§æµæœ€å°å‰²å®šç†ã€‘ï¼šActually, The following three conditions are equivalent:**  
  **(a) Flow f is a max-flow G**  
  **(b) Residual graph $G_f$ has no augmenting path**  
  **(c) $|f|=c(S, T)$ for some $cut(S, T)$ of $G$**
+ å®šç†è¯æ˜åˆ†ä¸ºä¸‰éƒ¨åˆ†
  + ![](img/2019-12-16-18-22-16.png)
  + ![](img/2019-12-16-18-22-31.png)
  + ![](img/2019-12-16-18-22-45.png)

## Max-Flow Min-cut and LP Duality
+ æœ€å¤§æµé—®é¢˜å¯è¢«å»ºæ¨¡ä¸ºçº¿æ€§è§„åˆ’é—®é¢˜P
+ å› æ­¤Pä¸€å®šæœ‰ä¸€ä¸ªå¯¹å¶é—®é¢˜D
+ æ ¹æ®å¼ºå¯¹å¶æ€§ï¼š$OPT(P)=OPT(D)$
+ ç„¶è€Œæœ€å°å‰²å¹¶ä¸æ­£å¥½æ˜¯Pçš„å¯¹å¶é—®é¢˜ã€‚æœ€å°å‰²é—®é¢˜å¯ä»¥è¢«å»ºæ¨¡ä¸ºæ•´æ•°è§„åˆ’é—®é¢˜(ILP) Dâ€˜ï¼Œè€Œæœ€å¤§æµçš„å¯¹å¶é—®é¢˜Dæ˜¯Dâ€™çš„æ”¾æ¾ã€‚
+ å› æ­¤ï¼Œ$OPT(D')\geq OPT(D)$
+ å¹¸è¿çš„æ˜¯ï¼Œ$OPT(D')=OPT(D)$
+ å› æ­¤$OPT(P)=OPT(D')$


---
## æ”¹è¿›Ford-Fulkersonç®—æ³•
### æ–¹æ³•ä¸€
+ åœ¨é€‰æ‹©å¢å¼ºæµæ—¶ï¼Œæ¯æ¬¡éƒ½é€‰æ‹©ç“¶é¢ˆå€¼æœ€å¤§çš„å¢å¼ºæµ
  + é€‰æ‹©æ–¹æ³•å¯ä½¿ç”¨ç±»ä¼¼Dijkstraç®—æ³•ä¸­çš„æ¾å¼›æ€æƒ³ï¼Œä¸è¿‡æ˜¯å‘â€œæ›´å¤§çš„ç“¶é¢ˆå€¼â€æ–¹å‘æ¾å¼›
  + é€‰æ‹©å¯åœ¨$O(m\log n)$æ—¶é—´å†…å®Œæˆ
+ ä¸‹é¢è¯„ä¼°ç®—æ³•æ€§èƒ½
  + **ã€Flow Decompositionã€‘ï¼šGiven $G$ and a flow $f$, there is a collection of flows $f_1, f_2, ...,f_k$, and a collection of $s\rightarrow t$ paths $p_1, p_2, ...,p_k$, such that:(a) $k\leq |E|$, (b) $|f|=|f_1|+...+|f_k|$ and (c) $f_i$ only sends flow over $p_i$**
    ![](img/2019-12-16-19-10-48.png)
  + ä»¤$f$ä¸ºä»»ä½•æµï¼Œä»¤$f'$ä¸º$G_f$ä¸­çš„æœ€å¤§æµ
  + ç”±è·¯å¾„åˆ†è§£å®šç†ï¼Œåœ¨$G_f$ä¸­å­˜åœ¨ä¸€æ¡flow $\geq|f'|/(2m)$çš„è·¯å¾„
  + å› æ­¤åœ¨æ¯ä¸€æ¬¡è¿­ä»£ä¹‹åï¼Œ$|f'|\leq |f'|(1-1/(2m))$
  + ç»è¿‡$2m\ln(f_{OPT})$æ¬¡è¿­ä»£ï¼Œ$|f'|\leq f_{OPT}(1-1/(2m))^{2m\ln (f_{OPT})}<1$
    + å¦‚æœcapacityå‡ä¸ºæ•´æ•°ï¼Œåˆ™ç®—æ³•ç»ˆæ­¢
    + å¦‚æœcapacityä¸ºå®æ•°ï¼Œåˆ™ç®—æ³•å°†é€æ¸æ”¶æ•›ï¼ˆä¹Ÿæœ‰å¯èƒ½æ— æ³•æ”¶æ•›åˆ°æœ€ä¼˜å€¼ï¼‰
  + æ€»è€Œè¨€ä¹‹ï¼Œè¯¥æ–¹æ³•åœ¨å®æ•°capacityæƒ…å†µä¸‹è¿è¡Œæ—¶é—´ä¸º$O(m^2(\log n)(\log f_{OPT}))$

### æ–¹æ³•äºŒï¼šEdmonds-Karp
+ åœ¨é€‰æ‹©å¢å¼ºæµæ—¶ï¼Œé€‰æ‹©æœ€çŸ­çš„å¢å¼ºæµ
  + ç›´æ¥ä½¿ç”¨BFSå³å¯
+ ä¸‹é¢è¯„ä¼°ç®—æ³•æ€§èƒ½
  + ä»¤$d_f(u, v)$è¡¨ç¤ºåœ¨å›¾$G_f$ä¸­èŠ‚ç‚¹$u$å’Œ$v$ä¹‹é—´çš„è·ç¦»
  + **ã€Lemma1ã€‘ï¼šLet ğ‘  be the source node, then for each node ğ‘£âˆˆğ‘‰âˆ’{ğ‘ ,ğ‘¡}, during execution, $d_f(s, v)$ will not decrease with each flow augmentation.**  
    ![](img/2019-12-16-20-00-27.png)
  + ä»ä¸Šè¿°è¿‡ç¨‹å¯å‘ç°åœ¨å¢å¼ºçš„è¿‡ç¨‹ä¸­ï¼ŒæŸäº›è¾¹$(u, v)$å¯èƒ½ä¼šåœ¨å½“å‰æµä¸­â€œæ¶ˆå¤±â€ã€‚
  + **ã€Lemma2ã€‘ï¼šeach edge (u, v) can disappear for at most $\frac{|V|}2$ times during execution**  
    ![](img/2019-12-16-20-06-42.png)
  + å› æ­¤ï¼Œç®—æ³•å°†åœ¨$O(|V|\cdot |E|^2)$æ—¶é—´åç»ˆæ­¢
  + ç”±è¯¥ç®—æ³•çš„è¿è¡Œè¿‡ç¨‹ä¹Ÿå¯ä»¥å‘ç°ï¼Œè¯¥ç®—æ³•æ°¸è¿œç»ˆæ­¢äºæœ€ä¼˜è§£ï¼Œé™¤éä¸èƒ½ç»ˆæ­¢ã€‚

---
## ç½‘ç»œæµåº”ç”¨ï¼šæœ€å¤§äºŒåˆ†åŒ¹é…
+ é—®é¢˜æè¿°  
  ![](img/2019-12-16-20-50-20.png)

+ æ„å»ºç½‘ç»œ$G'=(V', E')
  + $V'=V\cup \{s, t\}$
  + $E'=\{(s, u):u\in L\}\cup \{(v, t):v\in R\}\cup \{(u, v):(u, v)\in E\}$
  + ä¸ºæ¯æ¡$E'$ä¸­çš„è¾¹åˆ†ç±»å¤§å°ä¸º1çš„capacity
+ æ˜“è§ï¼Œåœ¨$G'$ä¸­å­˜åœ¨æµ$f$ç­‰ä»·äºåœ¨äºŒåˆ†å›¾$G$ä¸­å­˜åœ¨åŒ¹é…$M$ï¼Œä¸”$|M|=|f|$  
  ![](img/2019-12-16-13-46-31.png)
+ å› æ­¤ä½¿ç”¨æœ€å¤§æµç®—æ³•å³å¯å¾—åˆ°æ­£ç¡®ç»“æœ